<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <style>
      .textarea {
        position: relative;
        display: inline-block;
        width: 800px;
        height: 600px;
        border: 1px solid #000;
        overflow: auto;
      }
    </style>
    <script>
      window.onload = function() {
        var color_el = document.getElementById("color");
        var fontSize_el = document.getElementById("fontSize");
        var textarea_el = document.getElementById("textarea");
        color_el.addEventListener("change", function(e) {
          var selection = window.getSelection();
          var range = selection.getRangeAt(0);
          if (range) {
            document.execCommand("styleWithCSS", null, true);
            document.execCommand("ForeColor", false, e.currentTarget.value);
          }
        });
        fontSize_el.addEventListener("change", function(e) {
          console.log("aaaa");
          var selection = window.getSelection();
          var range = selection.getRangeAt(0);
          if (range) {
            document.execCommand("styleWithCSS", null, true);
            document.execCommand("fontSize", false, e.currentTarget.value);
          }
        });
      };
      function color_change(e) {
        var selection = window.getSelection();
        //var elem = selection.getRangeAt(0).commonAncestorContainer.parentNode;
        //var element = document.createElement("h1");
        //selection.getRangeAt(0).surroundContents(element);
        var range = selection.getRangeAt(0);
        //var documentFragment = range.extractContents();
        /*console.log(
          selection,
          range,
          range.commonAncestorContainer,
          selection.rangeCount
        );*/

        if (range) {
          selection.removeAllRanges();
          selection.addRange(range);
        }
        document.execCommand("ForeColor", false, e.currentTarget.value);
        console.log(e.currentTarget.value);
        //var documentFragmentChildNodes = documentFragment.childNodes;
        /*for (var i = 0; i < documentFragmentChildNodes.length; i++) {
          var style = documentFragmentChildNodes[i].style;
          if (style) {
          }
          //console.log([documentFragmentChildNodes[i]]);
        }*/
        //console.log(range);
        //console.log(selection.focusNode, documentFragment.childNodes);
        //range.insertNode(documentFragment);
        //document.body.appendChild(documentFragment);
        /*rootNode = range.commonAncestorContainer;
        console.log("aaa", selection, range, rootNode);*/

        //var newParent = document.createElement("h1");
        //range.surroundContents(newParent);
      }
    </script>
  </head>
  <body>
    <!--<select name="color">
      <option value="red">紅色</option>
      <option value="green">綠色</option>
      <option value="blue">藍色</option>
    </select>-->
    <table>
      <tbody>
        <tr>
          <td>
            <label>
              <span>選擇顏色：</span>
              <input type="color" id="color" />
            </label>
            <label>
              <span>選擇文字大小：</span>
              <select id="fontSize">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
              </select>
            </label>
          </td>
        </tr>
        <tr>
          <td>
            <div contenteditable="true" class="textarea" id="textarea">
              <p>
                這裡是一段文字，選擇後可以設定上方的顏色跟文字大小，很陽春沒有任何功能的文字編輯器。
              </p>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </body>
</html>
